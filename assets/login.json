{
  "$view": {
    "attributes": {
      "_id": "garage",
      "statusBar.style": "dark",
      "bg.color": "#cdcdcd"
    },
    "actions": [
      {
        "_type": "1Navigate",
        "attributes": {
          "to": "location.json"
        },
        "enabled": [
          "if :: [[$session.fb_token]] == '' :: false"
        ],
        "on": "willFirstAppear"
      }
    ],
    "controls": [
      {
        "_id": "bgImage",
        "_type": "Image",
        "actions": [
          {
            "_type": "Navigate",
            "attributes": {
              "to": "location.json"
            },
            "on": "touchUp"
          }
        ],
        "attributes": {
          "image": "/images/bg.png",
          "layoutType": "absolute",
          "size.h": "100%",
          "size.w": "100%"
        }
      },
      {
        "_id": "layoutMain",
        "_type": "Layout",
        "attributes": {
          "size.w": "100%",
          "size.h": "100%",
          "visible": true,
          "bg.color": "ffffff00",
          "layoutType": "float"
        },
        "controls": [
          {
            "_id": "customHeader",
            "_type": "Custom",
            "actions": [
              {
                "_type": "Function",
                "attributes": {
                  "_target": "$app",
                  "functionName": "drawer.l.toggle"
                },
                "on": "button.left"
              }
            ],
            "attributes": {
              "size.w": "100%",
              "size.h": 62,
              "visible": true,
              "title": "Login",
              "button.left": "../images/btnMenu_42x42.png",
              "controlLocation": "/controls/header.json",
              "layoutType": "float"
            },
            "controls": []
          }
        ]
      },
      {
        "_id": "FBLogin",
        "_type": "FBLogin",
        "actions": [
          {
            "_type": "Modify",
            "attributes": {
              "_target": "$session"
            },
            "set": {
              "fb_token": "[[FBLogin.token]]"
            },
            "on": "login.success"
          },
          {
            "_type": "Refresh",
            "attributes": {
              "_target": "fbLogin"
            },
            "on": "login.success"
          }
        ],
        "attributes": {
          "type": "button",
          "align.h": "center",
          "align.v": "middle",
          "border.radius": 0,
          "color": "6c6c6c",
          "layoutType": "float",
          "size.h": 50,
          "size.w": 200
        }
      },
      {
        "_id": "button",
        "_type": "Button",
        "actions": [
          {
            "_type": "Navigate",
            "attributes": {
              "to": "location.json"
            },
            "on": "touchUp"
          }
        ],
        "attributes": {
          "visible":false,
          "align.h": "center",
          "align.v": "bottom",
          "bg.color": "cdcdcd",
          "margin.bottom": 50,
          "color": "6c6c6c",
          "layoutType": "float",
          "size.h": 50,
          "size.w": 200,
          "text": "Location Tracking",
          "touch.bg.color": "cdcdcd",
          "touch.color": "6c6c6c50"
        }
      }
    ],
    "datasources": [
      {
        "_id": "fbLogin",
        "_type": "HTTP",
        "actions": [
          {
            "_type": "Modify",
            "attributes": {
              "_target": "$session"
            },
            "set": {
              "user_uuid": "[[$self.response.body.user.uuid]]",
              "user_name_first": "[[$self.response.body.user.facebook.first_name]]",
              "user_name_last": "[[$self.response.body.user.facebook.last_name]]",
              "user_picture": "[[$self.response.body.user.picture]]",
              "access_token": "[[$self.response.body.access_token]]"
            },
            "on": "success"
          },
          {
            "_type": "Alert",
            "attributes": {
              "title": "[[$session.user_picture]]"
            },
            "enabled":false,
            "on": "success"
          },
          {
            "_type": "1Navigate",
            "attributes": {
              "to": "location.json"
            },
            "on": "success"
          }
        ],
        "attributes": {
          "autoLoad.enabled": false,
          "method": "GET",
          "url": "https://api.usergrid.com/vta/sandbox/auth/facebook?fb_access_token=[[$session.fb_token]]"
        }
      }
    ]
  }
}